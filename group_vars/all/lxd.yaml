
# since netdata systemd unit requires this we need this on all containers
lxd_container_security_nesting: true


lxd_container_image_distribution: debian
lxd_container_image_release: bullseye
lxd_container_image_architecture: amd64 # TODO auto select architecture of lxd_host
lxd_container_image_variant: cloud

lxd_container_profiles:
  - default

lxd_container_source:
  type: image
  mode: pull
  server: https://images.linuxcontainers.org
  protocol: lxd
  alias: "{{ lxd_container_image_distribution }}/{{ lxd_container_image_release }}/{{ lxd_container_image_architecture }}/{{ lxd_container_image_variant }}"

lxd_container_config:
  limits.cpu: "{{ lxd_container_limits_cpu | default(2) | string}}"
  limits.memory: "{{ lxd_container_limits_memory | default('2GB') | string }}"
  security.nesting: "{{ lxd_container_security_nesting | default(false) | string }}"
  user.network-config: "{{ lxd_container_user_network_config }}"

lxd_container_devices: "{{ lxd_container_default_devices | combine(lxd_container_network_devices) | combine(lxd_container_custom_devices|default({})) }}"

lxd_container_default_devices:
  root:
    path: /
    pool: default
    type: disk
lxd_container_network_devices:
  eth0: |
   {{ lxd_container_network_devices_default_eth0
   | combine(lxd_container_ipv6_routes is defined|ternary(lxd_container_network_devices_lxd_container_ipv6_routes,{}))
   | combine(lxd_container_ipv4_routes is defined|ternary(lxd_container_network_devices_lxd_container_ipv4_routes,{}))
   }}
lxd_container_network_devices_default_eth0:
    name: eth0
    network: lxdbr0
    type: nic
lxd_container_user_network_config:
  version: 1
  config:
    - type: physical
      name:  eth0
      subnets: "{{lxd_container_user_network_config_subnets | default([{'type':'dhcp'}]) }}"
lxd_container_network_devices_lxd_container_ipv6_routes:
  ipv6.routes: "{{ lxd_container_ipv6_routes | default([]) | join(',') }}"
lxd_container_network_devices_lxd_container_ipv4_routes:
  ipv4.routes: "{{ lxd_container_ipv4_routes | default([]) | join(',') }}"
