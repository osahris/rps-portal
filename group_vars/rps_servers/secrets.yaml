---
secrets_fact: # this are the vars that are going to be saved in the local vars file
  gitlab_deploy_token_password:                     "{{ gitlab_deploy_token_password | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  collabora_admin_password:                         "{{ ansible_local.secrets.collabora_admin_password              | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  keycloak_admin_password:                          "{{ ansible_local.secrets.keycloak_admin_password               | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  keycloak_postgres_password:                       "{{ ansible_local.secrets.keycloak_postgres_password            | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  keycloak_subrealm_client_secret:                  "{{ ansible_local.secrets.keycloak_subrealm_client_secret       | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  oauth2_proxy_client_secret:                       "{{ ansible_local.secrets.oauth2_proxy_client_secret            | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  oauth2_proxy_cookie_secret:                       "{{ ansible_local.secrets.oauth2_proxy_cookie_secret            | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  wordpress_staging_admin_password:                 "{{ ansible_local.secrets.wordpress_staging_admin_password      | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  wordpress_staging_mysql_password:                 "{{ ansible_local.secrets.wordpress_staging_mysql_password      | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  wordpress_prod_admin_password:                    "{{ ansible_local.secrets.wordpress_prod_admin_password         | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  wordpress_prod_mysql_password:                    "{{ ansible_local.secrets.wordpress_prod_mysql_password         | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  nextcloud_keycloak_client_secret:                 "{{ ansible_local.secrets.nextcloud_keycloak_client_secret      | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  rps_admin_web_interface_db_password:              "{{ ansible_local.secrets.rps_admin_web_interface_db_password   | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  rps_admin_web_interface_secret_key:               "{{ ansible_local.secrets.rps_admin_web_interface_secret_key    | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  rps_groups_interface_rps_client_secret:           "{{ rps_groups_interface_rps_client_secret                      | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  rps_groups_interface_rps_cookie_secret:           "{{ rps_groups_interface_rps_cookie_secret                      | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  rps_groups_interface_projektportal_client_secret: "{{ rps_groups_interface_projektportal_client_secret            | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  rps_groups_interface_projektportal_cookie_secret: "{{ rps_groups_interface_projektportal_cookie_secret            | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  wiki_js_database_password:                        "{{ ansible_local.secrets.wiki_js_database_password             | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  wiki_bookstack_keycloak_client_secret:            "{{ ansible_local.secrets.wiki_bookstack_keycloak_client_secret | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  discourse_database_password:                      "{{ discourse_database_password | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  discourse_openid_client_secret:                   "{{ discourse_openid_client_secret | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"

collabora_admin_password:                         "{{ ansible_local.secrets.collabora_admin_password }}"
keycloak_admin_password:                          "{{ ansible_local.secrets.keycloak_admin_password }}"
keycloak_postgres_password:                       "{{ ansible_local.secrets.keycloak_postgres_password }}"
keycloak_subrealm_client_secret:                  "{{ ansible_local.secrets.keycloak_subrealm_client_secret }}"
oauth2_proxy_client_secret:                       "{{ ansible_local.secrets.oauth2_proxy_client_secret }}"
oauth2_proxy_cookie_secret:                       "{{ ansible_local.secrets.oauth2_proxy_cookie_secret }}"
wordpress_staging_admin_password:                 "{{ ansible_local.secrets.wordpress_staging_admin_password }}"
wordpress_staging_mysql_password:                 "{{ ansible_local.secrets.wordpress_staging_mysql_password }}"
wordpress_prod_admin_password:                    "{{ ansible_local.secrets.wordpress_prod_admin_password }}"
wordpress_prod_mysql_password:                    "{{ ansible_local.secrets.wordpress_prod_mysql_password }}"
nextcloud_keycloak_client_secret:                 "{{ ansible_local.secrets.nextcloud_keycloak_client_secret }}"
rps_admin_web_interface_secret_key:               "{{ ansible_local.secrets.rps_admin_web_interface_secret_key }}"
rps_admin_web_interface_db_password:              "{{ ansible_local.secrets.rps_admin_web_interface_db_password }}"
rps_groups_interface_rps_client_secret:           "{{ ansible_local.secrets.rps_groups_interface_rps_client_secret }}"
rps_groups_interface_rps_cookie_secret:           "{{ ansible_local.secrets.rps_groups_interface_rps_cookie_secret }}"
rps_groups_interface_projektportal_client_secret: "{{ ansible_local.secrets.rps_groups_interface_projektportal_client_secret }}"
rps_groups_interface_projektportal_cookie_secret: "{{ ansible_local.secrets.rps_groups_interface_projektportal_cookie_secret }}"
wiki_js_database_password:                        "{{ ansible_local.secrets.wiki_js_database_password }}"
wiki_bookstack_keycloak_client_secret:            "{{ ansible_local.secrets.wiki_bookstack_keycloak_client_secret }}"
discourse_database_password: "{{ ansible_local.secrets.discourse_database_password }}"
discourse_openid_client_secret: "{{ ansible_local.secrets.discourse_openid_client_secret }}"

# whatever is put into default() will execute immediately which means if we but the lookup stuff in there the prompt will be shown ALWAYS
# so take a short umweg default it to false so that or logic will only be executed if the password has not yet been set
# this also means btw. that the lines above create new passwords on every execution (performance). but they will be discarded right away
gitlab_deploy_token_password: "{{ ansible_local.secrets.gitlab_deploy_token_password | default(False) or lookup('prompt', 'Please enter the password of the gitlab rps group deploy token: ') }}"
