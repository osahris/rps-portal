---
keycloak_service_name: "keycloak.{{ inventory_hostname }}"
keycloak_realm: rps

keycloak_realms:
  - name: rps
    # groups that should be created in our realm
    groups:
      - developers
      - support
      - scientists
      - vip
    roles:
      - name: approved
      - name: groups-management
        associated_roles:
          - realm-management.view-users
          - realm-management.query-users
          - realm-management.query-groups
          - realm-management.manage-users

  - name: projektportal
    # subrealm is a subrealm. so it doesn't have its own login form but redirects to the parent_realm and imports users from there
    parent_realm:
      # name of parent_realm (on the same keycloak server)
      name: rps
      # whatever secret you want. use ansible_vault or something else
      client_secret: "{{ keycloak_subrealm_client_secret }}"
      import:
        # import user attribute "title" from parent_realm
        - name: "title"
          type: "attribute"
        # import test group from parent_realm
        - name: "test"
          type: "group"
        # import test2 group from group test in parent_realm
        - name: "test2"
          type: "group"
          from: "test"
        # assign "test" role when user is in "test2" group in parent_realm
        - name: "test"
          type: "role_from_group"
          from_group: "test2"
      # user must be in group "test" or "test2" (you probably need to somehow import it - see above - or set it manually after initial import)
      required_groups:
        - "test"
        - "test2"
      # same just for roles
      required_roles:
        - "test"
    groups:
      - "test"
    roles:
      - name: "test"
