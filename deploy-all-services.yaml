---
- hosts: rps_servers
  become: true


  pre_tasks:

  - name: Display current host
    debug: 
      msg: 
      - "{{ ansible_ssh_host }}"
      - "{{ inventory_hostname }}"
  - name: ansible facts directory
    file:
      path: /etc/ansible/facts.d
      state: directory
  - name: ansible secrets facts
    copy:
      content: "{{ secrets_fact | to_nice_json }}"
      dest: /etc/ansible/facts.d/secrets.fact
  - name: Gather facts again after secrets generation
    setup:


  roles:

  - role: docker
    tags: docker

  - role: traefik
    tags: traefik

  - role: collabora
    tags: collabora

  - role: idia
    tags: idia

  - role: keycloak
    tags: keycloak
  - role: keycloak-realms
    tags: keycloak-realms
  - role: oauth2-proxy
    oauth2_proxy_docker_container_name: oauth2-proxy-ingress
    tags: oauth2-proxy-ingress
  - role: rps-groups-interface
    tags: rps-groups-interface
# - role: rps_admin_web_interface
#   tags: rps-admin-web-interface