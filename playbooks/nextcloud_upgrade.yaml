---

- hosts: rps_servers
  become: true
  tasks:

    - name: Deploy current Nextcloud version
      ansible.builtin.import_role:
        name: nextcloud
        tasks_from: deploy.yaml
      vars:
        nextcloud_version: "{{ nextcloud_current_version }}"

    - name: Display the Nextcloud upgrade path
      debug:
        var: nextcloud_upgrade_path_via_versions

    - name: Upgrade Nextcloud to version {{ nextcloud_version }}
      ansible.builtin.include_role:
        name: nextcloud
        tasks_from: upgrade.yaml

    - name: Deploy and configure Nextcloud target version
      ansible.builtin.import_role:
        name: nextcloud
      vars:
        nextcloud_version: "{{ nextcloud_target_version }}"
