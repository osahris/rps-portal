---

- import_role:
    name: docker

- name: discourse docker repo
  git:
    repo: https://github.com/discourse/discourse_docker.git
    dest: /var/lib/discourse

- name: discourse container config
  template:
    src: "{{item}}.yaml.j2"
    dest: /var/lib/discourse/containers/{{item}}.yml
  with_items: "{{ discourse_containers }}"

- name: rebuild discourse containers
  command: ./launcher rebuild "{{item}}"
  args:
    chdir: /var/lib/discourse
  with_items: "{{ discourse_containers }}"
