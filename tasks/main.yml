---

# shamelessly copied from https://github.com/fabianfreyer/ansible-openproject

- import_tasks: reset.yml
  when: openproject_state == "reinstalled"

- import_tasks: user.yml

- import_tasks: rbenv.yml
  vars:
    ruby_version: "{{openproject_ruby_version}}"
    rbenv_directory: "{{openproject_path}}/.rbenv"
    rbenv_user: '{{openproject_user}}'
    rbenv_group: '{{openproject_group}}'
  tags: ruby

- import_tasks: nodenv.yml
  vars:
    node_version: "{{openproject_node_version}}"
    nodenv_directory: "{{openproject_path}}/.nodenv"
    nodenv_user: '{{openproject_user}}'
    nodenv_group: '{{openproject_group}}'
  tags: node

# - debug:
#     msg: RAILS_ENV=production PATH={{openproject_env_path}}:$PATH

- import_tasks: install.yml

- import_tasks: database.yml
  tags: mysql

- import_tasks: memcached.yml

- import_tasks: customize.yml

- import_tasks: configure.yml

- import_tasks: unicorn.yml

- import_tasks: certificate.yml

- import_tasks: nginx.yml
  tags: nginx

# - import_tasks: cron.yml
#  tags: cron

- name: flush handlers
  meta: flush_handlers
