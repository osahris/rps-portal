---

- name: Shutdown docker-compose stack
  docker_compose:
    project_src: "{{remote_path}}/"
    pull: true
    remove_orphans: true
    state: absent

- name: Bring Nextcloud database up
  docker_compose:
    project_src: "{{remote_path}}/"
    pull: true
    remove_orphans: true
    services:
      - postgres

- name: Display the Nextcloud upgrade path
  debug:
    var: nextcloud_upgrade_path_via_versions

- include_tasks: upgrade_loop.yaml
  vars:
    nextcloud_version: "{{ item }}"
  loop: "{{ nextcloud_upgrade_path_via_versions }}"

- name: Deploy docker-compose stack
  docker_compose:
    project_src: "{{remote_path}}/"
    pull: true
    remove_orphans: true
