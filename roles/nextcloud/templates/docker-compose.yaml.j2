---
version: "3"

networks:
  proxy:
    external: true
  nextcloud-internal:

volumes:
  db:
  nextcloud:

services:

  nextcloud:
    image: nextcloud:25.0
    restart: unless-stopped
    logging:
      options:
        max-size: 5m
    restart: unless-stopped
    # ports:
    #   - 8080:80
    networks:
      - proxy
      - nextcloud-internal
    depends_on:
      - db
    volumes:
      - nextcloud:/var/www/html
    env_file:
      - "./env"

# docker exec -u www-data -it nextcloud_app php occ maintenance:install --admin-user "admin" --admin-pass "pass"
# docker exec -u www-data -it nextcloud_app php occ app:install sociallogin

  db:
    image: mariadb:10.5
    restart: unless-stopped
    logging:
      options:
        max-size: 5m
    networks:
      - nextcloud-internal
    volumes:
      - db:/var/lib/mysql
    env_file:
      - "./env"
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW
