---
- name: matrix app matrix_sync_target_directory
  file:
    path: "{{matrix_sync_target_directory}}"
    state: directory

# - name: copy all static files
#   synchronize:
#     recursive: true
#     src: "./" # relative to ./files on local role path
#     dest: "{{matrix_sync_target_directory}}" # relative to ~/ on remote

- name: matrix sync config file
  template:
    src: ".env.j2"
    dest: "{{matrix_sync_target_directory}}/.env"

- name: docker-compose file
  template:
    src: "docker-compose.yaml.j2"
    dest: "{{matrix_sync_target_directory}}/docker-compose.yaml"

- name: deploy docker-compose only for sync
  docker_compose:
    profiles: "sync"
    project_src: "{{matrix_sync_target_directory}}"
    pull: true
    build: true
    remove_orphans: true
    recreate: always
