# needed for the rps_admin_interface role
rps_admin_web_interface_git_repo: https://{{ gitlab_deploy_token}}@gitlab.com/idcohorts/rps/rps-admin-tools.git
rps_admin_web_interface_directory: /root/rps-admin-web-interface/rps-admin-tools
rps_admin_web_interface_log_directory: /var/log/rps-admin-web-interface
rps_admin_web_interface_db_directory: /var/lib/rps-admin-web-interface
rps_admin_web_interface_logs_directory: "{{rps_admin_web_interface_directory}}/web_interface/logs"
rps_admin_web_interface_config_directory: /etc/rps-admin-web-interface
rps_admin_web_interface_config_file: "{{rps_admin_web_interface_config_directory}}/rps-admin-tools.json"
rps_admin_web_interface_media_directory: "{{rps_admin_web_interface_directory}}/web_interface/media"

# needed for traefik role
rps_admin_tools_web_1_dynamic_config:
  http:
    routers:
      rps-admin-tools-web-1:
        rule: "Host(`{{rps_admin_web_interface_server_name}}`)"
        entrypoints: websecure
        service: rps-admin-tools-web-1
    services:
      rps-admin-tools-web-1:
        loadBalancer:
          servers:
            - url: http://rps-admin-tools_web_1:8000

rps_tools_config: |
  {
    "project_id": {{project_id|to_json}},
    "project_name": {{project_name|to_json}},

    "user_first_name_label": {{user_first_name_label|to_json}},
    "user_last_name_label": {{user_last_name_label|to_json}},
    "user_email_label": {{user_email_label|to_json}},
    "user_username_label": {{user_username_label|to_json}},

    "user_import_group_owner_label": {{user_import_group_owner_label|to_json}},
    "user_import_group_membership_label": {{user_import_group_membership_label|to_json}},

    "group_sync_default_membership_source": {{group_sync_default_membership_source|to_json}},
    "group_sync_default_membership_store": {{group_sync_default_membership_store|to_json}},

    "user_attributes": {{ user_attributes | default([]) |to_json }},
    "group_hierarchy": {{ group_hierarchy | default([]) |to_json }},
    "global_groups": {{ global_groups | default([]) |to_json }},
    "groups_global_mailinglist_owners": {{ groups_global_mailinglist_owners | default([]) |to_json }},
    "groups_global_mailinglist_editors": {{ groups_global_mailinglist_editors | default([]) |to_json }},

    "services":{
      "group hierachy":{
        "service_type": "group_hierachy",
      },
      {% for service in groups.keycloak_servers | default([]) %}
      {{service|to_json}}:{
        "service_type": "keycloak",
        "keycloak_management_url": {{hostvars[service].keycloak_management_url|to_json}},
        "keycloak_management_username": {{hostvars[service].keycloak_management_username|to_json}},
        "keycloak_management_password": {{hostvars[service].keycloak_management_password|to_json}},
        "keycloak_management_realm": {{hostvars[service].keycloak_management_realm|to_json}},
        "keycloak_realm": {{hostvars[service].keycloak_realm|to_json}},
      },
      {{(service+'/profile')|to_json}}:{
        "service_type": "keycloak_profile",
        "keycloak_management_url": {{hostvars[service].keycloak_management_url|to_json}},
        "keycloak_management_username": {{hostvars[service].keycloak_management_username|to_json}},
        "keycloak_management_password": {{hostvars[service].keycloak_management_password|to_json}},
        "keycloak_management_realm": {{hostvars[service].keycloak_management_realm|to_json}},
        "keycloak_realm": {{hostvars[service].keycloak_realm|to_json}},
      },
      {% endfor %}
      {% for service in groups.discourse_servers | default([]) %}
      {{service|to_json}}:{{ hostvars[service].rps_service_admin_config |to_json }},
      {% endfor %}
      {% for service in groups.nextcloud_servers | default([]) %}
      {{service|to_json}}:{{ hostvars[service].rps_service_admin_config |to_json }},
      {% endfor %}
      {% for service in groups.loomio_servers | default([]) %}
      {{service|to_json}}:{
        "service_type":"loomio",
        "loomio_server_name": {{ hostvars[service].loomio_server_name |to_json }},
        "loomio_url": {{ ('https://' + hostvars[service].loomio_server_name + '/') |to_json }},
        "loomio_client_cookie": {{ ('https://' + hostvars[service].loomio_client_cookie + '/') |to_json }}
      },
      {% endfor %}
      {% for service in groups.mailinglist_servers | default([]) %}
      {{service|to_json}}:{
        "service_type":"sympa",
        "sympa_export_rsync_target":
          "sympa-sync@{{service}}:/var/lib/mailinglist-sync/{{service}}"
      },
      {% endfor %}
    },

  }