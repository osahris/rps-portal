---
- name: docker debian packages installed
  apt:
    update_cache: true
    pkg:
      - docker.io
      - python3-docker
      - docker-compose
      - apparmor

- name: start docker service
  service:
    name: docker
    state: started

- name: create oauth2-proxy docker container
  docker_container:
    name: "{{oauth2_proxy_docker_container_name}}"
    image: "{{oauth2_proxy_oci_image}}"
    networks:
      - name: "{{traefik_proxy_network}}"
    env: "{{oauth2_proxy_environment}}"
    restart_policy: unless-stopped

- name: traefik dynamic config
  copy:
    content: "{{ oauth2_proxy_traefik_dynamic_config }}"
    dest: "{{traefik_config_directory}}/conf.d/oauth2-proxy.yaml"
