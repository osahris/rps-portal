---
remote_path: /app/{{ wordpress_service_name }}

wordpress_secrets:
  wordpress_admin_password: "{{ wordpress_admin_password | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  wordpress_mysql_password: "{{ wordpress_mysql_password | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"
  wordpress_mysql_root_password: "{{ wordpress_mysql_root_password | default(lookup('ansible.builtin.password', '/dev/null length=32 chars=ascii_letters,digits')) }}"

wordpress_traefik_router_profiles:
  oauth2:
    rule: "Host(`{{wordpress_service_name}}`)"
    entrypoints: websecure
    middlewares: 
      - header-redirect
      - oauth2
    service: "{{ wordpress_service_name }}"
  public:
    rule: "Host(`{{wordpress_service_name}}`)"
    entrypoints: websecure
    middlewares: 
      - header-redirect
    service: "{{ wordpress_service_name }}"

wordpress_traefik_service_config:
  loadBalancer:
    servers:
      - url: "http://{{ wordpress_service_name | replace('.', '') }}_wordpress_1"

wordpress_traefik_dynamic_config:
  http:
    routers: "{{ { wordpress_service_name : wordpress_traefik_router_profiles[wordpress_traefik_profile] } }}"
    services: "{{ { wordpress_service_name : wordpress_traefik_service_config } }}"
