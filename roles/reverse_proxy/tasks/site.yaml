---

- include_role:
    name: certificate
  vars:
    certificate_name: "{{hostvars[vhost].reverse_proxy_server_name}}"
    certificate_common_name: "{{hostvars[vhost].reverse_proxy_server_name}}"
  loop: "{{reverse_proxy_for_hosts}}"
  loop_control:
    loop_var: vhost

- include_role:
    name: nginx
    tasks_from: vhost
  vars:
    nginx_vhost_name: "{{vhost}}"
    nginx_vhost_server_names: ["{{hostvars[vhost].reverse_proxy_server_name}}"]
    nginx_vhost_certificate_name: "{{hostvars[vhost].reverse_proxy_server_name}}"
    nginx_vhost_custom: "{{hostvars[vhost].reverse_proxy_nginx_vhost_custom}}"
  loop: "{{reverse_proxy_for_hosts}}"
  loop_control:
    loop_var: vhost
