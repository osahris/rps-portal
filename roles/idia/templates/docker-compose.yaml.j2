---
version: "3"

networks:
  {{project_name}}:
    external: true
  proxy:
    external: true

services:

  idia: # Service name
    container_name: {{project_name}}_app
    image: idia # Image name
    build:
      context: ./
      dockerfile: Dockerfile
    logging:
      options:
        max-size: 5m
    restart: unless-stopped
    # expose:
    #   - "801" # Uncomment if other containers should reach through this port internally
    networks:
      - proxy
      - {{project_name}} # Uncomment if a network out of scope of Traefik needed
    volumes:
      - ./db:/app/idia/db

# docker exec -it idia_app bash
# python3
# from app import db
# db.create_all()

  # idia_db:
  #   container_name: {{project_name}}_db
  #   image: postgres:14
  #   restart: always
  #   expose:
  #     - "5432"
  #   networks:
  #     - {{project_name}}
  #   volumes:
  #     - ./pg-data:/var/lib/postgresql/data
  #   environment:
  #     POSTGRES_DB:       "idia_db"
  #     POSTGRES_USER:     "admin"
  #     POSTGRES_PASSWORD: "xASB4hOAMZM0FI6Zg6Yh#hRjl*Jf-kPC"