---
version: "3"

networks:
  proxy:
    external: true

services:
  header:
    image: {{ rps_header_image }}
    restart: unless-stopped
    networks:
      - proxy
    volumes:
      - ./header_config.yaml:/opt/header/config.yaml:ro
{% if rps_header_webserver_env == "dev" %}
      - ./js:/opt/header/js:ro
{% endif %}
    environment:
      RPS_HEADER_WEBSERVER_ENV: ${RPS_HEADER_WEBSERVER_ENV}
      RPS_HEADER_USERINFO_URL: ${RPS_HEADER_USERINFO_URL}
      RPS_HEADER_SIGN_IN_URL: ${RPS_HEADER_SIGN_IN_URL}
      RPS_HEADER_SIGN_OUT_URL: ${RPS_HEADER_SIGN_OUT_URL}
      RPS_HEADER_ROOT_REDIRECT_URL: ${RPS_HEADER_ROOT_REDIRECT_URL}

  always-200-responder:
    image: nginx:1
    command:
      - /bin/sh 
      - -c
      - "echo 'server { listen 80; location / { return 200; } }' > /etc/nginx/conf.d/default.conf && exec nginx -g 'daemon off;'"
    networks:
      - proxy
    restart: unless-stopped
