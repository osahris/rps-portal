{{ ansible_managed | comment }}

RESTIC_CONFIG_NAME="{{ item.name }}"
RESTIC_REPOSITORY_FILE="/etc/restic/passwords/{{ restic_backup_url_hostport | b64encode }}.repos"
{% if item.database_dump_command is undefined %}
RESTIC_DIRECTORIES="{{ item.directories|quote }}"
{% endif %}
RESTIC_FLAGS="--cacert /etc/ssl/certs/restic-server-certs.pem {{ item.flags|quote|default('') }}"

RESTIC_PASSWORD_FILE="/etc/restic/repositories/{{ item.repository }}.key"

# XXX: Our restic-rest daemon uses a self-signed certificate as generated by "provider-selfsigned.yml".
#      The Go TLS library complains about this cert with the following error message:
#      "x509: certificate relies on legacy Common Name field, use SANs or temporarily enable Common Name matching with GODEBUG=x509ignoreCN=0".
#      Since this doesn't matter for out usecase, we set this ENV var below for the forseeable future.
GODEBUG="x509ignoreCN=0"
