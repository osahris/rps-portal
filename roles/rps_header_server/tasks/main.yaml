---

- import_role:
    name: docker

- name: clone header repo
  git:
    repo: "{{ header_repo }}"
    dest: /opt/header
    version: "{{ header_version }}"

- name: write header config
  copy:
    content: "{{ header_config | to_json}}"
    dest: /opt/header/config.json

- name: build header image
  community.docker.docker_image:
    name: header
    source: build
    build:
      path: /opt/header
      rm: false
    tag: current
    force_tag: true
    force_source: true

- name: header container
  community.general.docker_container:
    name: header
    image: header:dev
    restart_policy: always
    container_default_behavior: no_defaults
    networks_cli_compatible: false
    state: started
    ports:
     - "80:80"
  