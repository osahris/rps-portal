---

- import_role:
    name: podman

- name: required debian packages
  apt:
    pkg:
      - git

- name: clone header repo
  git:
    repo: "{{ header_repo }}"
    dest: /opt/header
    version: "{{ header_version }}"

- name: write header config
  copy:
    content: "{{ header_config | to_json}}"
    dest: /opt/header/config.json
  when: false

- name: build header image
  containers.podman.podman_image:
    name: header
    path: /opt/header
    tag: current
    force: true
    build:
      rm: false

- name: header container
  containers.podman.podman_container:
    name: header
    image: header:current
    ports:
     - "80:80"
    recreate: true
  