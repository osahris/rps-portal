---
- hosts: all:!mailinglist_servers
  remote_user: root
  tasks:
    - name: ensure an updated apt cache
      apt:
        update_cache: yes

    - name: ensure all all apt packages are updated to their latest version
      apt:
        state: latest

    # needed for various purposes: e.g. postgres collation rules
    - name: ensure required locales exist
      locale_gen:
        name: "{{ item }}"
        state: present
      with_items:
      - de_DE.UTF-8

- hosts: all
  remote_user: root
  tasks:
    - name: Dir for supplementary systemd config
      ansible.builtin.file:
        path: /etc/systemd/system.conf.d/
        state: directory
        mode: 0755
    - name: Configure systemd to use "combined" logging format
      ansible.builtin.copy:
        content: |
          # This file was placed by RPS ansible; don't edit.
          [Manager]
          StatusUnitFormat=combined
        dest: /etc/systemd/system.conf.d/01-RPS-statusunitformat.conf
        follow: false
        owner: root
        group: root
        mode: 0644
    - name: Reload Systemd's own configuration
      ansible.builtin.systemd:
        daemon_reload: yes
